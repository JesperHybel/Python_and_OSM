# I need to make sure I can also read into R. 
# So I could choose to save as shapefile. However, apparently some people are not to impressed by the shapefile:

# Barry Rowlingson b.rowlingson at lancaster.ac.uk
# Wed Jul 13 19:44:28 CEST 2016

# [...] the agency from which I got the data has been enlightened
# enough not to use the clunky, outdated, and limited "shapefile" format
# and has released the data as a modern, OGC-standard GeoPackage. My
# variables have long names, my metadata is stored with my data, and its
# all in one file instead of six. [...]

# Shapefiles are an awful, awful format which Esri didn't think people
# would actually use. They should not be encouraged. [...] 

# Barry

# Also author of OSMnx package Geoff Boeing says:
# save graph as a geopackage
# you can similarly save it as a shapefile, if you prefer obsolete formats
# http://jsta.github.io/2016/07/14/geopackage-r.html

# Lets do this:
# First I make a polygon for downloading the city of Aalborg the fourth largest city of Denmark.
# To do this I use https://extract.bbbike.org/

import networkx as nx
import osmnx as ox

from shapely.geometry import Polygon

poly_odense = Polygon([[10.341,55.351],[10.417,55.341],[10.478,55.343],[10.501,55.414],[10.424,55.449],[10.342,55.447],[10.282,55.426],[10.297,55.385]])
poly_aalborg = Polygon([[9.855,56.998],[9.926,56.989],[9.982,57.01],[9.99,57.101],[9.942,57.101],[9.907,57.087],[9.862,57.046]])

# Download network 
g_aalborg = ox.graph_from_polygon(poly_aalborg, network_type="all")
# Save network in geopackage format
ox.save_graph_geopackage(g_aalborg, filepath="./data/aalborg_network_all.gpkg")
# I also like to do a plot
fig, ax = ox.plot_graph(g_aalborg, figsize=(10, 10), node_size=0, edge_color="w", edge_linewidth=0.2)


# I now change from Python to R and try to load the .gpkg file into R following instructions from here 
# http://jsta.github.io/2016/07/14/geopackage-r.html
# Another option is to use the package sf (which I think is a better option because I believe it is more up to date)
# https://ryanpeek.org/mapping-in-R-workshop/02_import_export_gpkg.html

	path_data <- "C://Users//np83zg//PycharmProjects//pythonProject2//data"
	setwd(path_data)
	dir()

	library(sf)
	st_layers("aalborg_network_all.gpkg")
	# Driver: GPKG 
	# Available layers:
  	# layer_name geometry_type features fields
	# 1      nodes         Point    18584      6
	# 2      edges   Line String    25642     19

	# Two layers are available the nodes and edges of network graph
	# Try to read both ... it reads only first layer
	st_read("aalborg_network_all.gpkg")

	aalborg_nodes <- st_read("aalborg_network_all.gpkg",layer="nodes")
	aalborg_edges <- st_read("aalborg_network_all.gpkg",layer="edges")

	# inspect data
	head(aalborg_nodes)
	head(aalborg_edges)
	
	# plot nodes and edges
	library(tmap)
	qtm(aalborg_nodes)
	qtm(aalborg_edges)
	
  
  
  
  
  

